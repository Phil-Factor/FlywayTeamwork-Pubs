{
    "columns":  [
                    "location int",
                    "@string varchar(100)",
                    "Note int",
                    "hits int"
                ],
    "Definition":  "CREATE FUNCTION [dbo].[FindWords]\r\n  /*\r\nsummary:  \u003e\nThis Table-valued function takes text as a parameter and tries to find it in the people.WordOccurence table\nAuthor: Phil Factor\nexample:\r\n   - code: SELECT * FROM FindWords(\u0027disgusting\u0027)\r\n   - code: SELECT * FROM FindWords(\u0027Yvonne\u0027)\r\n   - code: SELECT * FROM FindWords(\u0027unacceptable\u0027)\r\n   - code: SELECT TOP 10 note_id, Max(NoteStart) AS Note_Start, \r\n                 Max(InsertionDate)AS Insertion_Date, \r\n                 Max(InsertedBy) AS Inserted_by  \r\n             from \r\n\t         (SELECT note_id, NoteStart, InsertionDate, InsertedBy \r\n\t         FROM people.note NS\r\n\t         INNER JOIN FindWords(\u0027disgusting ridiculous\u0027) FW\r\n\t         ON FW.note=NS.note_id)f\r\n             group by Note_id\r\n             order by Max(InsertionDate) desc\nreturns:  \u003e\r\npasses back the location where they were found, and the number of words matched in the string.\r\n**/\r\n  (@string VARCHAR(100))\r\nRETURNS @finds TABLE (location INT NOT NULL, Note INT NOT NULL, hits INT NOT NULL)\r\nAS\r\n  BEGIN\r\n    DECLARE @WordsToLookUp TABLE\r\n      (\r\n      Item VARCHAR(255) NOT NULL,\r\n      location INT NOT NULL,\r\n      Sequence INT NOT NULL PRIMARY KEY\r\n      );\r\n    DECLARE @wordCount INT, @searches INT;\r\n    -- chop the string into its constituent words, with the sequence\r\n    INSERT INTO @WordsToLookUp (Item, location, Sequence)\r\n      SELECT Item, location, Sequence FROM dbo.IterativeWordChop(@string);\r\n    -- determine how many words and work out what proportion to search for\r\n    SELECT @wordCount = @@RowCount;\r\n    SELECT @searches =\r\n       CASE WHEN @wordCount \u003c 6 THEN @wordCount ELSE 2 + (@wordCount / 2) END;\r\n    IF @wordcount=1\r\n\t\tBEGIN\r\n\t\tINSERT INTO @finds (location, Note, hits)\r\n\t\t\tSELECT MIN(location), Note, 1 \r\n\t\t\tFROM people.WordOccurence WHERE item LIKE @string GROUP BY Note\r\n        return\r\n\t\tEND \r\n\t\tINSERT INTO @finds (location, Note, hits)\r\n\t\t   SELECT Min(Firstlocation), Note, @wordcount  FROM \r\n\t  (SELECT wordswanted.[sequence] AS theorder,Note,\r\n\t  Min(WordOccurence.location) AS FirstLocation \r\n        FROM -- @WordsToLookUp wordsWanted\r\n\t\t(\r\n            SELECT TOP (@searches) Word.Item, searchterm.Sequence\r\n              FROM @WordsToLookUp searchterm\r\n                INNER JOIN people.Word\r\n                  ON searchterm.Item = Word.Item\r\n              ORDER BY frequency\r\n            ) wordsWanted(item, Sequence)\r\n\t  INNER JOIN people.WordOccurence ON WordOccurence.Item = wordsWanted.Item\r\n\t  GROUP BY Note,wordsWanted.[sequence])f\r\n GROUP BY Note\r\n HAVING Count(*)=@searches\r\n    RETURN;\r\n  END;",
    "documentation":  ""
}
